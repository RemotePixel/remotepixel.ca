(function(){var b=function(f){return f<10?"0"+f:f},a='<a href="https://earthdata.nasa.gov/gibs">NASA EOSDIS GIBS</a>';var c=function(i,h,f,k,j){var g=i.date?h:"0";return L.Util.template(i.template,{Time:g,TileMatrixSet:"GoogleMapsCompatible_Level"+i.zoom,TileMatrix:j,TileRow:k,TileCol:f})};var e=L.TileLayer.extend({initialize:function(g,f){this._layerInfo=L.GIBS_LAYERS[g];f=f||{};f.maxZoom=this._layerInfo.zoom;f.attribution=a;this._date=f.date||null;L.Util.setOptions(this,f);L.TileLayer.prototype.initialize.call(this,this._layerInfo.template,f)},getTileUrl:function(f){return c(this._layerInfo,this._date,f.x,f.y,f.z)},setDate:function(f){if(this._layerInfo.date){this._date=f;this._map&&this.redraw()}return this},isTemporal:function(){return this._layerInfo.date}});var d=L.TileLayer.Canvas.extend({initialize:function(g,f){L.Util.setOptions(this,{async:true,attribution:a});L.Util.setOptions(this,f);this._date=this.options.date||null;this._layerInfo=L.GIBS_LAYERS[g];if(!this._layerInfo){throw"Unknown GIBS layer name"}L.Util.setOptions(this,{maxZoom:this._layerInfo.zoom});this._maskInfo=null;if(g.indexOf("Terra")!==-1){this._maskInfo=L.GIBS_MASKS.MODIS_Terra_Data_No_Data}else{if(g.indexOf("Aqua")!==-1){this._maskInfo=L.GIBS_MASKS.MODIS_Aqua_Data_No_Data}}},setDate:function(f){if(this._layerInfo.date){this._date=f;this._map&&this.redraw()}return this},setTransparent:function(f){this.options.transparent=f;this._map&&this.redraw();return this},_loadImage:function(g,i,h){var f=new Image();f.onload=i.bind(null,f);f.onerror=h;f.crossOrigin="anonymous";f.src=g},drawTile:function(h,j,o){var l=this._maskInfo&&this.options.transparent,m,i,k=this;if(!this._date){return}var n=function(){if(m&&(i||!l)){if(m.width!==256||(l&&i.width!==256)){k.tileDrawn(h);return}var r=h.getContext("2d");r.drawImage(m,0,0);if(l){var q=r.getImageData(0,0,256,256);var u=document.createElement("canvas");u.width=u.height=256;var t=u.getContext("2d");t.drawImage(i,0,0);var s=t.getImageData(0,0,256,256).data,w=q.data;for(var v=0;v<s.length;v+=4){if(s[v+3]){w[v+3]=0}}r.putImageData(q,0,0)}k.tileDrawn(h)}};this._adjustTilePoint(j);var g=c(this._layerInfo,this._date,j.x,j.y,o);this._loadImage(g,function(p){m=p;n()},this.tileDrawn.bind(this,h));if(l){var f=c(this._maskInfo,this._date,j.x,j.y,o);this._loadImage(f,function(p){i=p;n()},this.tileDrawn.bind(this,h))}},isTemporal:function(){return this._layerInfo.date}});L.GIBSLayer=function(h,f){var i=L.GIBS_LAYERS[h];if(!i){throw"Unknown GIBS layer name"}var g=i.date&&"transparent" in f&&/jpg$/.test(i.template)&&(h.indexOf("Terra")!==-1||h.indexOf("Aqua")!==-1);return g?new d(h,f):new e(h,f)}})();