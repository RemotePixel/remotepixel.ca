var scope={aoiBounds:undefined,rp_scenes:[],api_url:"https://api.remotepixel.ca/landsat?search=",side:"L",before:undefined,after:undefined,before_overlays:undefined,after_overlays:undefined,filtervalues:{cloudmin:0,cloudmax:100,datestart:new Date("2013-04-01").toISOString().slice(0,10),dateend:new Date().toISOString().slice(0,10),seasons:["spring","summer","autumn","winter"]}};var map=L.map("map",{center:[0,0],bounceAtZoomLimits:false,worldCopyJump:false,touchZoom:false,inertia:false,zoomControl:false,doubleClickZoom:"center",scrollWheelZoom:"center",minZoom:1,zoom:2,maxZoom:11});var osm_url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',OpenStreetMap=L.tileLayer(osm_url,{id:"MapID",attribution:attribution}).addTo(map);L.control.zoom({position:"topright"}).addTo(map);var footprintGr=new L.featureGroup().addTo(map),markerGr=new L.featureGroup().addTo(map);map.fitWorld();map.on("dragend",function(){if(footprintGr.getLayers().length!==0){if(!footprintGr.getBounds().contains(map.getCenter())){updateMap(map.getCenter())}}else{updateMap(map.getCenter())}});L.easyButton("fa-home",function(){resetmap();resetFilters();map.fitWorld()},"Reset");L.easyButton("fa-share",function(){$("#twitter").attr("href","https://twitter.com/share?text=Easy creation of Landsat 8 Before/After map&url="+window.location.href+"&via=RemotePixel&hashtags=Landsat&related=NASA_Landsat");$("#linkedin").attr("href","https://www.linkedin.com/shareArticle?mini=true&url="+window.location.href+"&title="+document.title+"&source=https://remotepixel.ca");$("#facebook").attr("href","https://www.facebook.com/sharer/sharer.php?u="+window.location.href);$("#modalShare").modal()},"Share it");L.easyButton("fa-info",function(){$("#modalAbout").modal()},"About");function timestamp(a){return new Date(a).getTime()}function mod(b,a){return((b%a)+a)%a}function sortScenes(d,c){return Date.parse(c.acquisitionDate)-Date.parse(d.acquisitionDate)}function sortScenes2(d,c){return Date.parse(d.acquisitionDate)-Date.parse(c.acquisitionDate)}function zeroPad(b,a){var c=a-b.toString().length+1;return new Array(+(c>0&&c)).join("0")+b}function isInArray(b,a){return(b.indexOf(a)>=0)?true:false}function initFilters(){$("#cloudCoverSlider").noUiSlider({start:[scope.filtervalues.cloudmin,scope.filtervalues.cloudmax],step:1,behaviour:"drag",connect:true,range:{min:0,max:100}});$("#cloudCoverSlider").noUiSlider_pips({mode:"positions",values:[0,20,40,60,80,100],density:4});$("#cloudCoverSlider").on("slide",setCloud);$("#cloudCoverSlider").on("set",updateCloud);$("#dateSlider").noUiSlider({range:{min:timestamp(scope.filtervalues.datestart),max:timestamp(scope.filtervalues.dateend)},connect:true,step:24*60*60*1000,format:wNumb({decimals:0}),start:[timestamp(scope.filtervalues.datestart),timestamp(scope.filtervalues.dateend)]});var b=Date.parse(scope.filtervalues.dateend)-Date.parse(scope.filtervalues.datestart),a=[Date.parse(scope.filtervalues.datestart),Date.parse(scope.filtervalues.datestart)+b/4,Date.parse(scope.filtervalues.datestart)+2*b/4,Date.parse(scope.filtervalues.datestart)+3*b/4,Date.parse(scope.filtervalues.dateend)];$("#dateSlider").noUiSlider_pips({mode:"values",values:a,density:4,stepped:true});$("#dateSlider > .noUi-pips > .noUi-value").each(function(){$(this).html(new Date(Number($(this).html())).toISOString().slice(0,7))});$("#dateSlider").on("slide",setDate);$("#dateSlider").on("set",updateDate);$("#seasonSlider").noUiSlider({range:{min:0,max:4},margin:1,behaviour:"drag",connect:true,step:1,format:wNumb({decimals:0}),start:[0,4]});$("#seasonSlider").noUiSlider_pips({mode:"values",density:11,values:[0.5,1.5,2.5,3.5]});$("#seasonSlider > .noUi-pips > .noUi-value").each(function(){var c=["spring","summer","autumn","winter"];$(this).html(c[$(this).html()-1])});$("#seasonSlider").on("set",updateSeason);$("#string-date").text(" : "+scope.filtervalues.datestart+" - "+scope.filtervalues.dateend);$("#string-cloud").text(" : "+scope.filtervalues.cloudmin+" - "+scope.filtervalues.cloudmax+" %")}function toggleOpenFilter(a){switch(a){case"date":$("button#date").addClass("active");$("button#cloud").removeClass("active");$("button#season").removeClass("active");$("div.filter-date").removeClass("display-none");$("div.filter-cloud").addClass("display-none");$("div.filter-season").addClass("display-none");break;case"cloud":$("button#date").removeClass("active");$("button#cloud").addClass("active");$("button#season").removeClass("active");$("div.filter-date").addClass("display-none");$("div.filter-cloud").removeClass("display-none");$("div.filter-season").addClass("display-none");break;case"season":$("button#date").removeClass("active");$("button#cloud").removeClass("active");$("button#season").addClass("active");$("div.filter-date").addClass("display-none");$("div.filter-cloud").addClass("display-none");$("div.filter-season").removeClass("display-none");break;case null:break}}function resetFilters(){scope.filtervalues.cloudmin=0;scope.filtervalues.cloudmax=100;scope.filtervalues.datestart=new Date("2013-04-01").toISOString().slice(0,10);scope.filtervalues.dateend=new Date().toISOString().slice(0,10);scope.filtervalues.seasons=["spring","summer","autumn","winter"];$("#cloudCoverSlider").val([scope.filtervalues.cloudmin,scope.filtervalues.cloudmax]);$("#dateSlider").val([Date.parse(scope.filtervalues.datestart),Date.parse(scope.filtervalues.dateend)]);$("#seasonSlider").val([0,4]);$("#string-date").text(" : "+scope.filtervalues.datestart+" - "+scope.filtervalues.dateend);$("#string-cloud").text(" : "+scope.filtervalues.cloudmin+" - "+scope.filtervalues.cloudmax+" %")}function setCloud(){scope.filtervalues.cloudmin=parseInt($("#cloudCoverSlider").val()[0]);scope.filtervalues.cloudmax=parseInt($("#cloudCoverSlider").val()[1]);$("#string-cloud").text(" : "+scope.filtervalues.cloudmin+" - "+scope.filtervalues.cloudmax+" %")}function updateCloud(){scope.filtervalues.cloudmin=parseInt($("#cloudCoverSlider").val()[0]);scope.filtervalues.cloudmax=parseInt($("#cloudCoverSlider").val()[1]);$("#string-cloud").text(" : "+scope.filtervalues.cloudmin+" - "+scope.filtervalues.cloudmax+" %");filterScenes()}function setDate(){scope.filtervalues.datestart=new Date(Number($("#dateSlider").val()[0])).toISOString().slice(0,10);scope.filtervalues.dateend=new Date(Number($("#dateSlider").val()[1])).toISOString().slice(0,10);$("#string-date").text(" : "+scope.filtervalues.datestart+" - "+scope.filtervalues.dateend)}function updateDate(){scope.filtervalues.datestart=new Date(Number($("#dateSlider").val()[0])).toISOString().slice(0,10);scope.filtervalues.dateend=new Date(Number($("#dateSlider").val()[1])).toISOString().slice(0,10);$("#string-date").text(" : "+scope.filtervalues.datestart+" - "+scope.filtervalues.dateend);filterScenes()}function updateSeason(){var a=["spring","summer","autumn","winter"];scope.filtervalues.seasons=a.slice($("#seasonSlider").val()[0],$("#seasonSlider").val()[1]);filterScenes()}function filterScenes(){$("#landsat-wall").empty();$("#landsat-wall").scrollTop(0);var a;for(a=0;a<scope.rp_scenes.length;a+=1){var c=scope.rp_scenes[a],b='<div id ="scene_'+a+'" class="result-content" onclick="imgclick('+a+')" ><img id="'+scope.rp_scenes[a].sceneID+'" class="img-thumb"src="'+scope.rp_scenes[a].browseURL+'"><div class="result-overlay"><div><i class="fa fa-calendar-o"></i><span>  '+scope.rp_scenes[a].acquisitionDate+'</span></div><div><i class="fa fa-cloud"></i><span>  '+scope.rp_scenes[a].cloudCoverFull+" %</span></div></div>";if(scope.filtervalues.cloudmin<c.cloudCoverFull&&c.cloudCoverFull<scope.filtervalues.cloudmax){}else{continue}if(!isInArray(scope.filtervalues.seasons,c.season)){continue}if(Date.parse(scope.filtervalues.datestart)<Date.parse(c.acquisitionDate)&&Date.parse(c.acquisitionDate)<Date.parse(scope.filtervalues.dateend)){}else{continue}$("#landsat-wall").append(b)}}function backTopr(){cleanbaMaps();closeimagePane();mapbefore.remove();mapafter.remove();scope.rp_scenes=undefined;$("#map-container-ba").empty();$("#map-container-ba").addClass("display-none");$("#map-container").removeClass("display-none");map.invalidateSize()}function cleanbaMaps(){scope.before_overlays.clearLayers();scope.after_overlays.clearLayers();scope.before_overlays=undefined;scope.after_overlays=undefined;scope.side="L";scope.before=undefined;scope.after=undefined}function closeimagePane(){$("#imagePane").addClass("display-none")}function onURLids(){var b="https://api.remotepixel.ca/landsat?search=sceneID("+scope.before+","+scope.after+")&limit=2",a=[];$.getJSON(b,function(g){var k=g.info.results.total;if(k<2000){for(var h=0;h<g.results.length;h++){var j={};j.rowpath=g.results[h].row+"-"+g.results[h].path;j.acquisitionDate=g.results[h].acquisitionDate;j.browseAvailable=g.results[h].browseAvailable;j.lat=g.results[h].sceneCenterLatitude;j.lon=g.results[h].sceneCenterLongitude;j.sceneID=g.results[h].sceneID;j.browseURL=g.results[h].browseURL;j.pngURL="http://earthexplorer.usgs.gov/cgi-bin/landsat_8?sceneid="+j.sceneID;j.lowerLeftCornerLatitude=g.results[h].lowerLeftCornerLatitude;j.lowerRightCornerLatitude=g.results[h].lowerRightCornerLatitude;j.upperLeftCornerLatitude=g.results[h].upperLeftCornerLatitude;j.upperRightCornerLatitude=g.results[h].upperRightCornerLatitude;j.lowerLeftCornerLongitude=g.results[h].lowerLeftCornerLongitude;j.lowerRightCornerLongitude=g.results[h].lowerRightCornerLongitude;j.upperLeftCornerLongitude=g.results[h].upperLeftCornerLongitude;j.upperRightCornerLongitude=g.results[h].upperRightCornerLongitude;var l=Math.abs(j.lowerLeftCornerLongitude-j.lowerRightCornerLongitude);var f=Math.abs(j.upperLeftCornerLongitude-j.upperRightCornerLongitude);if((l>180)||(f>180)){if(j.lowerLeftCornerLongitude<0){j.lowerLeftCornerLongitude+=360}if(j.upperLeftCornerLongitude<0){j.upperLeftCornerLongitude+=360}if(j.lowerRightCornerLongitude<0){j.lowerRightCornerLongitude+=360}if(j.upperRightCornerLongitude<0){j.upperRightCornerLongitude+=360}}var m=turf.polygon([[[j.upperLeftCornerLongitude,j.upperLeftCornerLatitude],[j.upperRightCornerLongitude,j.upperRightCornerLatitude],[j.lowerRightCornerLongitude,j.lowerRightCornerLatitude],[j.lowerLeftCornerLongitude,j.lowerLeftCornerLatitude],[j.upperLeftCornerLongitude,j.upperLeftCornerLatitude]]]),o=turf.extent(m),c=[[o[3],o[0]],[o[3],o[2]],[o[1],o[2]],[o[1],o[0]]],d=[[j.upperLeftCornerLatitude,j.upperLeftCornerLongitude],[j.upperRightCornerLatitude,j.upperRightCornerLongitude],[j.lowerRightCornerLatitude,j.lowerRightCornerLongitude],[j.lowerLeftCornerLatitude,j.lowerLeftCornerLongitude],[j.upperLeftCornerLatitude,j.upperLeftCornerLongitude]],p={attribution:"&copy Landsat imagery courtesy of NASA and USGS",id:j.sceneID,time:j.acquisitionDate,info:{date:j.acquisitionDate,cloud:j.cloudCover,sun:j.sunAzimuth},clip:d};j.imOverlay=new L.ImageTransform(j.browseURL,c,p);a.push(j)}}scope.rp_scenes=a;$("#map-container").addClass("display-none");$("#map-container-ba").removeClass("display-none");$("#map-container-ba").append(['<div id="map-before" class="map"></div>','<div id="map-after" class="map"></div>']);mapbefore=L.map("map-before",{zoom:2,attributionControl:false,zoomControl:false,touchZoom:false,inertia:false,doubleClickZoom:"center",scrollWheelZoom:"center",center:[1,1],minZoom:1,maxZoom:11});scope.before_overlays=new L.layerGroup().addTo(mapbefore);mapafter=L.map("map-after",{zoom:2,attributionControl:false,zoomControl:false,touchZoom:false,inertia:false,doubleClickZoom:"center",scrollWheelZoom:"center",center:[1,1],minZoom:1,maxZoom:11});scope.after_overlays=new L.layerGroup().addTo(mapafter);var e="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",n='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>';L.tileLayer(e).addTo(mapbefore);L.tileLayer(e,{id:"MapID",attribution:n}).addTo(mapafter);L.control.zoom({position:"topright"}).addTo(mapafter);L.control.attribution({position:"bottomright"}).addTo(mapafter);L.easyButton("fa-arrow-circle-left",function(){backTopr()},"Back",mapafter);L.easyButton("fa-share",function(){if(scope.before!==""&&scope.after!==""){var i="https://remotepixel.ca/projects/landsat8beforeafter.html?before=&"+scope.before+"&after="+scope.after;$("#twitter").attr("href","https://twitter.com/share?url="+encodeURIComponent(i)+"&via=RemotePixel&hashtags=Landsat&related=NASA_Landsat&text=Landsat 8 Before/After map");$("#linkedin").attr("href","https://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(i)+"&title=Landsat 8 Before/After map&source=https://remotepixel.ca");$("#facebook").attr("href","https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(i))}else{$("#twitter").attr("href","https://twitter.com/share?text=Easy creation of Landsat 8 Before/After map&url="+window.location.href+"&via=RemotePixel&hashtags=Landsat&related=NASA_Landsat");$("#linkedin").attr("href","https://www.linkedin.com/shareArticle?mini=true&url="+window.location.href+"&title="+document.title+"&source=https://remotepixel.ca");$("#facebook").attr("href","https://www.facebook.com/sharer/sharer.php?u="+window.location.href)}$("#modalShare").modal()},"Share it",mapafter);L.easyButton("fa-info",function(){$("#modalAbout-pane2").modal()},"About",mapafter);$("#map-container-ba").beforeAfter(mapbefore,mapafter);scope.before_overlays.clearLayers();scope.before_overlays.addLayer(scope.rp_scenes[0].imOverlay);$("#lt-text").text(scope.rp_scenes[0].acquisitionDate);scope.after_overlays.clearLayers();scope.after_overlays.addLayer(scope.rp_scenes[1].imOverlay);$("#rt-text").text(scope.rp_scenes[1].acquisitionDate);mapbefore.sync(mapafter);mapafter.sync(mapbefore);mapafter.fitBounds(L.polygon(scope.rp_scenes[1].imOverlay.options.clip).getBounds())})}function onClickRowPath(){scope.rp_scenes=this.scenes;var a=this.getBounds();$("#map-container").addClass("display-none");$("#map-container-ba").removeClass("display-none");$("#map-container-ba").append(['<div id="map-before" class="map"></div>','<div id="map-after" class="map"></div>']);$("#imagePane").removeClass("display-none");mapbefore=L.map("map-before",{zoom:2,attributionControl:false,zoomControl:false,touchZoom:false,inertia:false,doubleClickZoom:"center",scrollWheelZoom:"center",center:[1,1],minZoom:1,maxZoom:11});mapbefore.fitBounds(a);scope.before_overlays=new L.layerGroup().addTo(mapbefore);var d={color:"#000",weight:2,fill:true,fillOpacity:0,opacity:1};L.polygon(this.getLatLngs(),d).addTo(mapbefore);mapafter=L.map("map-after",{zoom:2,attributionControl:false,zoomControl:false,touchZoom:false,inertia:false,doubleClickZoom:"center",scrollWheelZoom:"center",center:[1,1],minZoom:1,maxZoom:11});mapafter.fitBounds(a);scope.after_overlays=new L.layerGroup().addTo(mapafter);L.polygon(this.getLatLngs(),d).addTo(mapafter);var c="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";var b='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>';L.tileLayer(c).addTo(mapbefore);L.tileLayer(c,{id:"MapID",attribution:b}).addTo(mapafter);L.control.zoom({position:"topright"}).addTo(mapafter);L.control.attribution({position:"bottomright"}).addTo(mapafter);L.easyButton("fa-arrow-circle-left",function(){backTopr()},"Back",mapafter);L.easyButton("fa-eraser",function(){$("#imagePane").removeClass("display-none")},"Back",mapafter);L.easyButton("fa-sliders",function(){$("#imagePane").removeClass("display-none");$("#modalFilters").modal()},"Filter",mapafter);L.easyButton("fa-share",function(){if(scope.before_overlays.getLayers().length!=0&&scope.after_overlays.getLayers().length!=0){var f=scope.before_overlays.getLayers()[0].options.id;var g=scope.after_overlays.getLayers()[0].options.id;var e="https://remotepixel.ca/projects/landsat8beforeafter.html?before="+f+"&after="+g;$("#twitter").attr("href","https://twitter.com/share?url="+encodeURIComponent(e)+"&via=RemotePixel&hashtags=Landsat&related=NASA_Landsat&text=Landsat 8 Before/After map");$("#linkedin").attr("href","https://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(e)+"&title=Landsat 8 Before/After map&source=https://remotepixel.ca");$("#facebook").attr("href","https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e))}else{$("#twitter").attr("href","https://twitter.com/share?text=Easy creation of Landsat 8 Before/After map&url="+window.location.href+"&via=RemotePixel&hashtags=Landsat&related=NASA_Landsat");$("#linkedin").attr("href","https://www.linkedin.com/shareArticle?mini=true&url="+window.location.href+"&title="+document.title+"&source=https://remotepixel.ca");$("#facebook").attr("href","https://www.facebook.com/sharer/sharer.php?u="+window.location.href)}$("#modalShare").modal()},"Share it",mapafter);L.easyButton("fa-info",function(){$("#modalAbout-pane2").modal()},"About",mapafter);$("#map-container-ba").beforeAfter(mapbefore,mapafter);mapbefore.sync(mapafter);mapafter.sync(mapbefore);updateWall()}function updateWall(){$("#landsat-wall").empty();$("#landsat-wall").scrollTop(0);browse=[];for(var a=0;a<scope.rp_scenes.length;a++){browse.push('<div id ="scene_'+a+'" class="result-content" onclick="imgclick('+a+')" ><img id="'+scope.rp_scenes[a].sceneID+'" class="img-thumb"src="'+scope.rp_scenes[a].browseURL+'"><div class="result-overlay"><div><i class="fa fa-calendar-o"></i><span>  '+scope.rp_scenes[a].acquisitionDate+'</span></div><div><i class="fa fa-cloud"></i><span>  '+scope.rp_scenes[a].cloudCoverFull+" %</span></div></div>")}$("#landsat-wall").append(browse);browse=null}function imgclick(d){var f=scope.rp_scenes[d];var c=turf.polygon([[[f.upperLeftCornerLongitude,f.upperLeftCornerLatitude],[f.upperRightCornerLongitude,f.upperRightCornerLatitude],[f.lowerRightCornerLongitude,f.lowerRightCornerLatitude],[f.lowerLeftCornerLongitude,f.lowerLeftCornerLatitude],[f.upperLeftCornerLongitude,f.upperLeftCornerLatitude]]]);var h=turf.extent(c);var e=[[h[3],h[0]],[h[3],h[2]],[h[1],h[2]],[h[1],h[0]]];var b=[[f.upperLeftCornerLatitude,f.upperLeftCornerLongitude],[f.upperRightCornerLatitude,f.upperRightCornerLongitude],[f.lowerRightCornerLatitude,f.lowerRightCornerLongitude],[f.lowerLeftCornerLatitude,f.lowerLeftCornerLongitude],[f.upperLeftCornerLatitude,f.upperLeftCornerLongitude]];var a={attribution:"&copy Landsat imagery courtesy of NASA and USGS",id:f.sceneID,time:f.acquisitionDate,info:{date:f.acquisitionDate,cloud:f.cloudCover,sun:f.sunAzimuth},clip:b};var g=new L.ImageTransform(f.browseURL,e,a);if(scope.side=="L"){scope.before_overlays.clearLayers();scope.before_overlays.addLayer(g);$("#lt-text").text(f.acquisitionDate);$("#left-hover").remove();$('<div id="left-hover" class="result-hover"><div class="result-hover-content"><h3 id="hoverpos">L</h3></div></div>').prependTo($("#scene_"+d));scope.side="R"}else{scope.after_overlays.clearLayers();scope.after_overlays.addLayer(g);$("#rt-text").text(f.acquisitionDate);$("#right-hover").remove();$('<div id="right-hover" class="result-hover"><div class="result-hover-content"><h3 id="hoverpos">R</h3></div></div>').prependTo($("#scene_"+d));scope.side="L"}}function resetmap(){map.invalidateSize();footprintGr.clearLayers();markerGr.clearLayers();scope.rp_scenes=[]}function getSeason(i,e){var b=moment(i,"YYYY-MM-DD");var j=b.dayOfYear();var f=b.year();var k=moment({year:f,month:2,day:21}).dayOfYear();var d=moment({year:f,month:5,day:21}).dayOfYear();var a=moment({year:f,month:8,day:22}).dayOfYear();var h=moment({year:f,month:11,day:21}).dayOfYear();var c=["spring","summer","autumn","winter"];if(e<0){c.reverse()}var g="";if(j<k||j>=h){g=c[3]}if(j>=k&&j<d){g=c[0]}if(j>=d&&j<a){g=c[1]}if(j>=a&&j<h){g=c[2]}return g}function getDataAndUpdate(b){map.spin(true);resetmap();var c=Math.floor((map.getCenter().lng+180)/360)*360;var a={};$.getJSON(b,function(w){var x=w.info.results.total;if(x<2000){for(var r=0;r<w.results.length;r++){var v={};v.rowpath=w.results[r].row+"-"+w.results[r].path;v.className=w.results[r].sceneID+"-"+w.results[r].row+"-"+w.results[r].path;v.sceneID=w.results[r].sceneID;v.acquisitionDate=w.results[r].acquisitionDate;v.browseAvailable=w.results[r].browseAvailable;v.browseURL=w.results[r].browseURL;v.cloudCover=w.results[r].cloudCover;v.cloudCoverFull=w.results[r].cloudCoverFull;v.dayOrNight=w.results[r].dayOrNight;v.lat=w.results[r].sceneCenterLatitude;v.lon=w.results[r].sceneCenterLongitude;v.lon=v.lon+c;v.season=getSeason(v.acquisitionDate,v.lat);v.path=w.results[r].path;v.row=w.results[r].row;v.sensor=w.results[r].sensor;v.sunAzimuth=w.results[r].sunAzimuth;v.sunElevation=w.results[r].sunElevation;v.lowerLeftCornerLatitude=w.results[r].lowerLeftCornerLatitude;v.lowerRightCornerLatitude=w.results[r].lowerRightCornerLatitude;v.upperLeftCornerLatitude=w.results[r].upperLeftCornerLatitude;v.upperRightCornerLatitude=w.results[r].upperRightCornerLatitude;v.lowerLeftCornerLongitude=w.results[r].lowerLeftCornerLongitude;v.lowerRightCornerLongitude=w.results[r].lowerRightCornerLongitude;v.upperLeftCornerLongitude=w.results[r].upperLeftCornerLongitude;v.upperRightCornerLongitude=w.results[r].upperRightCornerLongitude;var n=Math.abs(v.lowerLeftCornerLongitude-v.lowerRightCornerLongitude);var e=Math.abs(v.upperLeftCornerLongitude-v.upperRightCornerLongitude);if((n>180)||(e>180)){if(v.lowerLeftCornerLongitude<0){v.lowerLeftCornerLongitude+=360}if(v.upperLeftCornerLongitude<0){v.upperLeftCornerLongitude+=360}if(v.lowerRightCornerLongitude<0){v.lowerRightCornerLongitude+=360}if(v.upperRightCornerLongitude<0){v.upperRightCornerLongitude+=360}}var g=["upperLeftCornerLongitude","upperRightCornerLongitude","lowerRightCornerLongitude","lowerLeftCornerLongitude"];for(var t=0;t<g.length;t++){v[g[t]]+=c}if((v.browseAvailable=="Y")&&(v.dayOrNight=="DAY")){var p=v.rowpath;if(a.hasOwnProperty(p)){a[p].push(v)}else{a[p]=[];a[p].push(v)}}}}var s={color:"#000",weight:2,fill:true,fillOpacity:0,opacity:1};var h={color:"#2262CC",weight:3,opacity:0.6,fill:true,fillOpacity:0.65,fillColor:"#2262CC"};var q=Object.keys(a);for(var r=0;r<q.length;r++){var o=a[q[r]][0];var j=L.latLng(o.lowerLeftCornerLatitude,o.lowerLeftCornerLongitude),d=L.latLng(o.lowerRightCornerLatitude,o.lowerRightCornerLongitude),l=L.latLng(o.upperLeftCornerLatitude,o.upperLeftCornerLongitude),f=L.latLng(o.upperRightCornerLatitude,o.upperRightCornerLongitude);var k=L.polygon([j,d,f,l],s).on("mouseover",function(){this.setStyle(h)}).on("mouseout",function(){this.setStyle(s)}).on("click",onClickRowPath);k.scenes=a[q[r]].sort(sortScenes2);k.id=q[r];var u=new L.DivIcon({html:"<div><span>"+k.scenes.length+"</span></div>",className:"marker-circle text-center",iconSize:new L.Point(30,30)});var m=new L.marker(k.getBounds().getCenter(),{icon:u,clickable:false,zIndexOffset:0,keyboard:false,opacity:0.5}).addTo(map);markerGr.addLayer(m);footprintGr.addLayer(k)}if(q.length===0){$("div.h4noim").removeClass("display-none")}else{$("div.h4noim").addClass("display-none")}map.spin(false)}).fail(function(){$("div.h4noim").removeClass("display-none");map.spin(false)})}function updateMap(a){if(typeof a==="undefined"){return}var e=(a.lat).toString(),f=(mod(a.lng+180,360)-180).toString(),d="upperLeftCornerLatitude:["+e+"+TO+1000]+AND+lowerRightCornerLatitude:[-1000+TO+"+e+"]",b="+AND+lowerLeftCornerLongitude:[-1000+TO+"+f+"]+AND+upperRightCornerLongitude:["+f+"+TO+1000]",c=scope.api_url+d+b+"&limit=2000";getDataAndUpdate(c)}function getUrlVars(){var b={},a=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(c,d,e){b[d]=e});return b}$(document).ready(function(){initFilters();var a=getUrlVars();if(a.hasOwnProperty("before")){scope.before=a.before}if(a.hasOwnProperty("after")){scope.after=a.after}if(scope.before!==""&&scope.after!==""){onURLids()}else{$("#modalAbout").modal()}});