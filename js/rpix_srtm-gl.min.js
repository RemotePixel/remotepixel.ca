mapboxgl.accessToken="{MAPBOX TOKEN}";var scope={uuid:"",tiles:[]},map=new mapboxgl.Map({container:"map",center:[0,0],attributionControl:false,doubleClickZoom:false,boxZoom:false,zoom:2,hash:true,style:"mapbox://styles/vincentsarago/cip322u6y0018dgnqrdh8zjo9",minZoom:2,maxZoom:7});map.dragRotate.disable();map.touchZoomRotate.disableRotation();map.addControl(new mapboxgl.Navigation());var btnreset=document.createElement("button");btnreset.className="mapboxgl-ctrl-icon";btnreset.setAttribute("onclick","reset()");var icnreset=document.createElement("i");icnreset.className="fa fa-refresh ";btnreset.appendChild(icnreset);var grp=document.createElement("div");grp.className="mapboxgl-ctrl-group mapboxgl-ctrl";grp.appendChild(btnreset);var control=document.getElementsByClassName("mapboxgl-ctrl-top-right");control[0].appendChild(grp.cloneNode(true));var ctrl=document.getElementsByClassName("mapboxgl-ctrl-bottom-right")[0],attr=document.createElement("div");attr.className="mapboxgl-ctrl-attrib mapboxgl-ctrl";ctrl.appendChild(attr);$(".mapboxgl-ctrl-attrib").append('<a href="https://remotepixel.ca" target="_blank">&copy; RemotePixel.ca</a>');$(".mapboxgl-ctrl-attrib").append('<a href="https://www.mapbox.com/about/maps/" target="_blank"> © Mapbox</a>');$(".mapboxgl-ctrl-attrib").append('<a href="http://www.openstreetmap.org/about/" target="_blank"> © OpenStreetMap</a>');function generateUUID(){var b=new Date().getTime();var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var d=(b+Math.random()*16)%16|0;b=Math.floor(b/16);return(e=="x"?d:(d&3|8)).toString(16)});return a}function selectTiles(){var a=["any"];scope.tiles.forEach(function(b){a.push(["==","Name",b])});map.setFilter("grdSRTM-selected",a);if((scope.tiles.length>1)&&(scope.tiles.length<9)){$(".tab-selector-2").prop("disabled",false)}else{$(".tab-selector-2").attr("disabled","disabled")}}function reset(){scope.tiles=[];selectTiles()}function back(){$(".tab-selector-1").prop("checked",true)}$(".tab-selector-2").change(function(){if(this.checked){scope.uuid=generateUUID()}else{scope.uuid=""}$(".form-rq").removeClass("display-none");$(".form-rq-resp").addClass("display-none");$(".uuid-text").text("Task ID: "+scope.uuid)});$("#submit-request").validator().on("valid.bs.validator",function(){$("#sendSRTMrequest").removeClass("disabled")}).on("invalid.bs.validator",function(){$("#sendSRTMrequest").addClass("disabled")});$("#sendSRTMrequest").on("click",function(c){if(!$("#sendSRTMrequest").hasClass("disabled")){var b={uuid:scope.uuid,tiles:scope.tiles,mailto:$("#EmailRequest").val(),};var a=$.post("{{ RPIX_API }}/srtm",JSON.stringify({info:b}));$(".form-rq").addClass("display-none");$(".form-rq-resp").removeClass("display-none");$(".form-rq").find("form")[0].reset()}});map.on("style.load",function(){map.addSource("srtm",{type:"vector",url:"mapbox://vincentsarago.brk5rjab"});map.addLayer({id:"grdSRTM-selected",type:"fill",source:"srtm","source-layer":"SRTM1arc_WGS84",paint:{"fill-outline-color":"#033b4e","fill-color":"#075c79","fill-opacity":0.5},filter:["in","Name",""]})});map.on("contextmenu",function(h){var c=map.queryRenderedFeatures(h.point,{layers:["srtm"]});if(!c.length){return}var k=c[0],j="http://e4ftl01.cr.usgs.gov/SRTM/SRTMGL1.003/2000.02.11/",i="https://s3.amazonaws.com/elevation-tiles-prod/skadi/",b=k.properties.Name,d=i+b.slice(0,3)+"/"+b+".hgt.gz",g=j+k.properties.Quicklook,f='<span class="marker-title">'+b+'</span><div class="popup-img"><img class="img-responsive" src="'+g+'""></div><div class="dwn-btn"><a class="btn btn-small btn-success" href="'+d+'" target="_blank">Download</a></div>';var a=new mapboxgl.Popup().setLngLat(h.lngLat).setHTML(f).addTo(map)});map.on("click",function(d){var c=map.queryRenderedFeatures(d.point,{layers:["srtm"]});if(!c.length){return}var b=c[0],a=scope.tiles.indexOf(b.properties.Name);if(a>-1){scope.tiles.splice(a,1)}else{scope.tiles.push(b.properties.Name)}selectTiles()});$(document).ready(function(){var a="https://remotepixel.ca/projects/srtm1arc-gl.html";$("#twitter").attr("href","https://twitter.com/share?url="+encodeURIComponent(a)+"&via=RemotePixel&text=SRTM 1arc tile Mosaic");$("#linkedin").attr("href","https://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(a)+"&title=SRTM 1arc tile Mosaic&source=https://remotepixel.ca");$("#facebook").attr("href","https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(a));$("#modalAbout").modal()});
