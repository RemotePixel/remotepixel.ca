var sat_api="https://api.developmentseed.org/satellites/",scope={results:{}};$("#modalPreview").on("shown.bs.modal",function(){$(".img-preview").focus()});$("#modalPreview").on("hidden.bs.modal",function(){$(".img-preview").scrollTop(0);$(".img-preview").empty()});$("#modalDownloadL8").on("shown.bs.modal",function(){$("#modalDownloadL8 .dwn-bands").focus();$("#modalDownloadL8 .btn-download").removeClass("processing");$("#modalDownloadL8 .btn-download").removeClass("error");$("#modalDownloadL8 .btn-download").removeClass("ready");$("#modalDownloadL8 .btn-download span").text("Download");$("#modalDownloadL8 .btn-download a").attr("href","");$("#modalDownloadL8 .dropdown-menu li a").each(function(){$(this).removeClass("on")});$("#modalDownloadL8 .dropdown-menu li a").first().addClass("on");$("#modalDownloadL8 .dropdown .btn:first-child").html($("#modalDownloadL8 .dropdown-menu li a").first().text()+' <span class="caret"></span>')});$("#modalDownloadL8").on("hidden.bs.modal",function(){$("#modalPreview").focus();$("#modalDownloadL8 .dwn-bands").empty();$("#modalDownloadL8 .overview").attr("data-id","");$("#modalDownloadL8 .overview").html('<span><i class="fa fa-spinner fa-spin"></i></span>')});$("#modalDownloadS2").on("shown.bs.modal",function(){$("#modalDownloadS2 .dwn-bands").focus();$("#modalDownloadS2 .dropdown-menu li a").each(function(){$(this).removeClass("on")});$("#modalDownloadS2 .dropdown-menu li a").first().addClass("on");$("#modalDownloadS2 .dropdown .btn:first-child").html($("#modalDownloadS2 .dropdown-menu li a").first().text()+' <span class="caret"></span>')});$("#modalDownloadS2").on("hidden.bs.modal",function(){$("#modalPreview").focus();$("#modalDownloadS2 .dwn-bands").empty();$("#modalDownloadS2 .overview").attr("data-id","");$("#modalDownloadS2 .overview").html('<span><i class="fa fa-spinner fa-spin"></i></span>')});$(function(){$("#modalDownloadS2 .dropdown-menu li a").click(function(){$("#modalDownloadS2 .overview").html('<span><i class="fa fa-spinner fa-spin"></i></span>');$("#modalDownloadS2 .dropdown .btn:first-child").html($(this).text()+' <span class="caret"></span>');var a={path:$("#modalDownloadS2 .overview").attr("data-id"),bands:$(this).parent().attr("data-bands")};if(a.bands==="[4,3,2]"){var b=$("#modalDownloadS2 .overview").attr("data-prev");$("#modalDownloadS2 .overview").html('<img src="'+b+'">')}else{$.post("{{ RPIX_API }}/sentinel2_ovr",JSON.stringify({info:a})).done(function(c){if(!(c.hasOwnProperty("errorMessage"))){$("#modalDownloadS2 .overview").html('<img src="data:image/png;base64,'+c.data+'">')}else{$("#modalDownloadS2 .overview").html("<span>Preview Unavailable</span>")}}).fail(function(){$("#modalDownloadS2 .overview").html("<span>Preview Unavailable</span>")})}$("#modalDownloadS2 .dropdown-menu li a").each(function(){$(this).removeClass("on")});$(this).addClass("on")})});$(function(){$("#modalDownloadL8 .dropdown-menu li a").click(function(){$("#modalDownloadL8 .btn-download").removeClass("processing");$("#modalDownloadL8 .btn-download").removeClass("error");$("#modalDownloadL8 .btn-download").removeClass("ready");$("#modalDownloadL8 .btn-download span").text("Download");$("#modalDownloadL8 .btn-download a").attr("href","");$("#modalDownloadL8 .overview").html('<span><i class="fa fa-spinner fa-spin"></i></span>');$("#modalDownloadL8 .dropdown .btn:first-child").html($(this).text()+' <span class="caret"></span>');var a={scene:$("#modalDownloadL8 .overview").attr("data-id"),bands:$(this).parent().attr("data-bands")};$.post("{{ RPIX_API }}/landsat/overview",JSON.stringify({info:a})).done(function(b){if(!(b.hasOwnProperty("errorMessage"))){$("#modalDownloadL8 .overview").html('<img src="data:image/png;base64,'+b.data+'">')}else{$("#modalDownloadL8 .overview").html("<span>Preview Unavailable</span>")}}).fail(function(){$("#modalDownloadL8 .overview").html("<span>Preview Unavailable</span>")});$("#modalDownloadL8 .dropdown-menu li a").each(function(){$(this).removeClass("on")});$(this).addClass("on")})});function landsatdownload(){$("#modalDownloadL8 button.btn-download").addClass("processing");var a={scene:$("#modalDownloadL8 .overview").attr("data-id"),bands:$("#modalDownloadL8 .dropdown-menu li .on").parent().attr("data-bands")};$.post("{{ RPIX_API }}/landsat/toa",JSON.stringify(a)).done(function(b){if(!(b.hasOwnProperty("errorMessage"))){$("#modalDownloadL8 button.btn-download").removeClass("processing");$("#modalDownloadL8 button.btn-download").addClass("ready");$("#modalDownloadL8 a.btn-download").attr("href",b.path)}else{$("#modalDownloadL8 button.btn-download").removeClass("processing");$("#modalDownloadL8 button.btn-download").addClass("error");$("#modalDownloadL8 button.btn-download span").text("Error")}}).fail(function(b,c){$("#modalDownloadL8 button.btn-download").removeClass("processing");$("#modalDownloadL8 button.btn-download").addClass("error");$("#modalDownloadL8 button.btn-download span").text("Error")})}function showSiteInfo(){$(".site-info").toggleClass("in");window.dispatchEvent(new Event("resize"))}function zeroPad(d,b){var a=String(d);if(a.length<b){return zeroPad("0"+d,b)}return a}function mod(b,a){return((b%a)+a)%a}function sortScenes(d,c){return Date.parse(c.date)-Date.parse(d.date)}function buildQueryAndRequestS2(a){$(".list-img").scrollTop(0);$(".list-img").empty();var c=a.lat,d=mod(a.lng+180,360)-180,b={};var e={intersects:{type:"Feature",properties:{},geometry:{coordinates:[d,c],type:"Point"}},satellite_name:"sentinel",limit:2000};$.ajax({url:sat_api,type:"POST",data:JSON.stringify(e),dataType:"json",contentType:"application/json",}).success(function(l){if(l.meta.found!==0){var j,m={};for(j=0;j<l.results.length;j+=1){m={};m.date=l.results[j].date;m.cloud=l.results[j].cloud_coverage;m.utm_zone=l.results[j].utm_zone.toString();m.grid_square=l.results[j].grid_square;m.latitude_band=l.results[j].latitude_band;m.sceneID=l.results[j].scene_id;m.browseURL=l.results[j].thumbnail.replace(".jp2",".jpg");m.path=l.results[j].aws_path.replace("tiles","#tiles");m.AWSurl="http://sentinel-s2-l1c.s3-website.eu-central-1.amazonaws.com/"+m.path+"/";m.grid=m.utm_zone+m.latitude_band+m.grid_square;if(b.hasOwnProperty(m.grid)){b[m.grid].push(m)}else{b[m.grid]=[];b[m.grid].push(m)}}var h=Object.keys(b),j;for(j=0;j<h.length;j+=1){b[h[j]].sort(sortScenes);var g=b[h[j]][0],f="['in', 'Name', '"+g.grid+"']",k="['in', 'Name', '']";$(".list-img").append('<div id ="'+g.grid+'" onclick="feedPreviewS2(this)" class="list-element"><div class="col"><div class="prinfo"><span class="pathrow">'+g.grid+'</span></div><div class="prinfo"><span class="date">Latest: '+g.date+'  </span><span class="date"><i class="fa fa-cloud"></i> '+g.cloud+'%</span></div></div><div class="img-thumb"><img id="'+g.sceneID+'" class="img-item img-responsive lazy2 lazyload"src="'+g.browseURL+'"></div></div>')}scope.results=b}else{$(".list-img").append('<span class="nodata-error">No image found</span>')}}).always(function(){$(".spin").addClass("display-none")}).fail(function(){$(".list-img").append('<span class="serv-error">Server Error: Please contact <a href="mailto:contact@remotepixel.ca">contact@remotepixel.ca</a></span>')})}function buildQueryAndRequestL8(a){$(".list-img").scrollTop(0);$(".list-img").empty();var c=a.lat,d=mod(a.lng+180,360)-180,b={};var e={intersects:{type:"Feature",properties:{},geometry:{coordinates:[d,c],type:"Point"}},satellite_name:"landsat",limit:2000};$.ajax({url:sat_api,type:"POST",data:JSON.stringify(e),dataType:"json",contentType:"application/json",}).success(function(l){if(l.meta.found!==0){var j,m={};for(j=0;j<l.results.length;j+=1){m={};m.path=l.results[j].path.toString();m.row=l.results[j].row.toString();m.grid=l.results[j].path+"/"+l.results[j].row;m.date=l.results[j].date;m.cloud=l.results[j].cloud_coverage;m.browseURL=l.results[j].browseURL;m.usgsURL=l.results[j].cartURL;m.sceneID=l.results[j].scene_id;m.AWSurl="http://landsat-pds.s3.amazonaws.com/L8/"+zeroPad(l.results[j].path,3)+"/"+zeroPad(l.results[j].row,3)+"/"+l.results[j].sceneID+"/";m.sumAWSurl="https://landsatonaws.com/L8/"+zeroPad(l.results[j].path,3)+"/"+zeroPad(l.results[j].row,3)+"/"+l.results[j].sceneID;if(b.hasOwnProperty(m.grid)){b[m.grid].push(m)}else{b[m.grid]=[];b[m.grid].push(m)}}var h=Object.keys(b),j;for(j=0;j<h.length;j+=1){b[h[j]].sort(sortScenes);var g=b[h[j]][0],f="['all', ['==', 'PATH', "+g.path+"], ['==', 'ROW', "+g.row+"]]",k="['all', ['==', 'PATH', ''], ['==', 'ROW', '']]";$(".list-img").append('<div id ="'+g.grid+'" onclick="feedPreviewL8(this)" class="list-element"><div class="col"><div class="prinfo"><span class="pathrow">'+g.grid+'</span></div><div class="prinfo"><span class="date">Latest: '+g.date+'  </span><span class="date"><i class="fa fa-cloud"></i> '+g.cloud+'%</span></div></div><div class="img-thumb"><img id="'+g.sceneID+'" class="img-item img-responsive lazy2 lazyload"src="'+g.browseURL+'"></div></div>')}scope.results=b}else{$(".list-img").append('<span class="nodata-error">No image found</span>')}}).always(function(){$(".spin").addClass("display-none")}).fail(function(){$(".list-img").append('<span class="serv-error">Server Error: Please contact <a href="mailto:contact@remotepixel.ca">contact@remotepixel.ca</a></span>')})}function feedPreviewS2(c){var b=scope.results[c.id],a;for(a=0;a<b.length;a+=1){$(".img-preview").append('<div class="item"><img class="img-item img-responsive lazy lazyload" data-src="'+b[a].browseURL+'" class="img-responsive"><div class="result-overlay"><span>'+b[a].sceneID+'</span><span><i class="fa fa-calendar-o"></i> '+b[a].date+'</span><span><i class="fa fa-cloud"></i> '+b[a].cloud+'%</span><span>Link:</span><div class="btnDD" onclick="feeddownloadS2(\''+b[a].path.replace("#tiles","tiles")+"','"+b[a].browseURL+'\')"><i class="fa fa-download"></i></div><a target="_blank" href="'+b[a].AWSurl+'"><img src="/img/aws.png"> </a></div></div>')}$("#modalPreview").modal()}function feeddownloadS2(b,c){var a="http://sentinel-s2-l1c.s3.amazonaws.com/";$("#modalDownloadS2 .overview").attr("data-id",b);$("#modalDownloadS2 .overview").attr("data-prev",c);$("#modalDownloadS2 .dwn-bands").append('<span>Direct Download S2 band (Right Click on link)</span><a id="b1" target="_blank" href="'+a+b+'/B01.jp2" download>B1 - Coastal (60m)</a><a id="b2" target="_blank" href="'+a+b+'/B02.jp2" download>B2 - Blue (10m)</a><a id="b3" target="_blank" href="'+a+b+'/B03.jp2" download>B3 - Green (10m)</a><a id="b4" target="_blank" href="'+a+b+'/B04.jp2" download>B4 - Red (10m)</a><a id="b5" target="_blank" href="'+a+b+'/B05.jp2" download>B5 - Vegetation Classif 1 (20m)</a><a id="b6" target="_blank" href="'+a+b+'/B06.jp2" download>B6 - Vegetation Classif 2 (20m)</a><a id="b7" target="_blank" href="'+a+b+'/B07.jp2" download>B7 - Vegetation Classif 3 (20m)</a><a id="b8" target="_blank" href="'+a+b+'/B08.jp2" download>B8 - Near Infrared (10m)</a><a id="b9" target="_blank" href="'+a+b+'/B09.jp2" download>B9 - Water vapour (60m)</a><a id="b10" target="_blank" href="'+a+b+'/B10.jp2" download>B10 - Cirrus (60m)</a><a id="b11" target="_blank" href="'+a+b+'/B11.jp2" download>B11 - Thermal Infrared 1 (20m)</a><a id="b12" target="_blank" href="'+a+b+'/B12.jp2" download>B12 - Thermal Infrared 2 (20m)</a><a id="mtl" target="_blank" href="'+a+b+'/productInfo.json" download>Metadata</a>');$("#modalDownloadS2 .overview").html('<img src="'+c+'">');$("#modalDownloadS2").modal()}function feedPreviewL8(c){var b=scope.results[c.id],a;for(a=0;a<b.length;a+=1){$(".img-preview").append('<div class="item"><img class="img-item img-responsive lazy lazyload" data-src="'+b[a].browseURL+'" class="img-responsive"><div class="result-overlay"><span>'+b[a].sceneID+'</span><span><i class="fa fa-calendar-o"></i> '+b[a].date+'</span><span><i class="fa fa-cloud"></i> '+b[a].cloud+'%</span><span>Link:</span><div class="btnDD" onclick="feeddownloadL8(\''+b[a].AWSurl+"','"+b[a].sceneID+'\')"><i class="fa fa-download"></i></div><a target="_blank" href="'+b[a].sumAWSurl+'"><img src="/img/aws.png"> </a><a target="_blank" href="'+b[a].usgsURL+'"><img src="/img/usgs.jpg"></a></div></div>')}$("#modalPreview").modal()}function feeddownloadL8(a,c){$("#modalDownloadL8 .overview").attr("data-id",c);$("#modalDownloadL8 .dwn-bands").append('<span>Direct Download L8 band (Right Click on link)</span><a id="b1" target="_blank" href="'+a+c+'_B1.TIF" download>B1 - Coastal aerosol</a><a id="b2" target="_blank" href="'+a+c+'_B2.TIF" download>B2 - Blue</a><a id="b3" target="_blank" href="'+a+c+'_B3.TIF" download>B3 - Green</a><a id="b4" target="_blank" href="'+a+c+'_B4.TIF" download>B4 - Red</a><a id="b5" target="_blank" href="'+a+c+'_B5.TIF" download>B5 - Near Infrared</a><a id="b6" target="_blank" href="'+a+c+'_B6.TIF" download>B6 - Shortwave Infrared 1</a><a id="b7" target="_blank" href="'+a+c+'_B7.TIF" download>B7 - Shortwave Infrared 2</a><a id="b8" target="_blank" href="'+a+c+'_B8.TIF" download>B8 - Panchromatic (15m)</a><a id="b9" target="_blank" href="'+a+c+'_B9.TIF" download>B9 - Cirrus</a><a id="b10" target="_blank" href="'+a+c+'_B10.TIF" download>B10 - Thermal Infrared 1</a><a id="b11" target="_blank" href="'+a+c+'_B11.TIF" download>B11 - Thermal Infrared 2</a><a id="bQA" target="_blank" href="'+a+c+'_BQA.TIF" download>BQA - Quality Assessment</a><a id="mtl" target="_blank" href="'+a+c+'_MTL.txt" download>MTL - Metadata</a>');var b={scene:c,bands:"[4,3,2]"};$.post("{{ RPIX_API }}/landsat/overview",JSON.stringify({info:b})).done(function(d){if(!(d.hasOwnProperty("errorMessage"))){$("#modalDownloadL8 .overview").html('<img src="data:image/png;base64,'+d.data+'">')}else{$("#modalDownloadL8 .overview").html("<span>Preview Unavailable</span>")}}).fail(function(){$("#modalDownloadL8 .overview").html("<span>Preview Unavailable</span>")});$("#modalDownloadL8").modal()}function changeStyle(){if(document.getElementById("sat-checkbox").checked){map.removeLayer(landsatMap);map.addLayer(sentinelMap)}else{map.removeLayer(sentinelMap);map.addLayer(landsatMap)}}$("#sat-checkbox").change(function(){$(".list-img").scrollTop(0);$(".list-img").empty();$(".list-img").append('<span class="nodata-error">Click on Tile</span>');$(".loading-map").removeClass("off");if(this.checked){$("#sat-checkbox").parent().addClass("slider-white")}else{$("#sat-checkbox").parent().removeClass("slider-white")}changeStyle()});L.mapbox.accessToken="{MAPBOX TOKEN}";var map=L.mapbox.map("map",undefined,{attributionControl:false}).setView([40,-70.5],3);var landsatMap=L.mapbox.styleLayer("mapbox://styles/vincentsarago/cin0walc0005cahnmimk2c3vy"),sentinelMap=L.mapbox.styleLayer("mapbox://styles/vincentsarago/ciowlfm34000gcmm54f3eb3ai");landsatMap.on("load",function(){$(".loading-map").addClass("off")});sentinelMap.on("load",function(){$(".loading-map").addClass("off")});map.addLayer(landsatMap);var ctrl=document.getElementsByClassName("leaflet-bottom leaflet-right")[0],attr=document.createElement("div");attr.className="leaflet-control-attribution leaflet-control";ctrl.appendChild(attr);$(".leaflet-control-attribution").append('<a href="https://remotepixel.ca" target="_blank">&copy; RemotePixel.ca</a>');$(".leaflet-control-attribution").append('<a href="https://www.mapbox.com/about/maps/" target="_blank"> © Mapbox</a>');$(".leaflet-control-attribution").append('<a href="http://www.openstreetmap.org/about/" target="_blank"> © OpenStreetMap</a>');$(".leaflet-control-attribution").append('<a href="https://www.digitalglobe.com/" target="_blank"> © DigitalGlobe</a></div>');map.on("click",function(a){scope.results={};$(".spin").removeClass("display-none");if(document.getElementById("sat-checkbox").checked){buildQueryAndRequestS2(a.latlng)}else{buildQueryAndRequestL8(a.latlng)}});$(document).ready(function(){$("#twitter").attr("href","https://twitter.com/share?url="+encodeURIComponent(window.location.href)+"&via=RemotePixel&text=Satellite Search");$("#linkedin").attr("href","https://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(window.location.href)+"&title=Satellite Search&source=https://remotepixel.ca");$("#facebook").attr("href","https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(window.location.href));$("#modalGL").modal()});
