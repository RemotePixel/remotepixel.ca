<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Check out this beautiful Landsat 8 image">
	<meta name="author" content="Vincent Sarago">
    <meta name="twitter:title" content="Landsat 8 Scene" />
    <meta name="twitter:site" content="@RemotePixel" />
    <meta name="twitter:description" content="Check out this beautiful Landsat 8 image" />

	<title>Remote Pixel | Landsat 8 Scene</title>

    <!-- leaflet CSS -->
    <link href="/css/leaflet.css" rel="stylesheet">

	<!-- Bootstrap Core CSS -->
	<link href="/css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom CSS -->
	<link href="/css/rpix_general.css" rel="stylesheet">

	<!-- Custom Fonts -->
	<link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet"
		type="text/css">

	<link
		href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"
		rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700"
		rel="stylesheet" type="text/css">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
	        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	    <![endif]-->

	<style>
        body{
            position:fixed;
        }

        .content {
            padding-top: 50px;
            height:100%;
            width: 100%;
        }

		input {
		    text-align:center;
		}

        #map {
            height: 100%;
            width: 100%;
            z-index: 0;
        }

		.img-thumb {
            width:100%;
            height:100%;
            opacity: 0;
		}

        .img-thumb-modal {
            width:70%;
            margin-bottom:15px;
            height:auto;
        }

		.legende{
		    position: absolute;
		    left: 10px;
		    bottom: 10px;
			color: #FFF;
		    text-align: left;
		    font-size: 16px;
		    padding: 5px 5px 5px 5px;
		    font-family: Montserrat, "Helvetica Neue", Helvetica, Arial, sans-serif;
		    background-color: rgba(0,0,0,0.1);
		    border-radius: 3px !important;
		    z-index: 1000;
		}
    </style>

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	  ga('create', 'UA-60678866-1', 'auto');
	  ga('send', 'pageview');
	</script>
</head>

<body data-target=".navbar-fixed-top">
    <!-- Navigation -->
	<nav class="navbar navbar-custom navbar-fixed-top top-nav-collapse" role="navigation">
		<div class="container">
			<div class="navbar-header">
			    <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target=".navbar-main-collapse">
                    <i class="fa fa-bars" style="color: #fff"></i></button>

				<a class="navbar-brand page-scroll" href="/projects/adayoflandsat8.html">
				    <i class="fa fa-play-circle"></i>
				    <span class="light">back</span>
			    </a>
			</div>
			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse navbar-right navbar-main-collapse">
				<ul class="nav navbar-nav">
					<!-- Hidden li included to remove active class from about link when scrolled up past about section -->
                    <li class="hidden"><a href="#page-top"></a></li>
					<li><a class="glyphicon glyphicon-home" href="/"></a></li>
					<li><a href="/projects/index.html">projects</a></li>
					<li><a href="/blog/index.html">Blog</a></li>
					<li><a href="/contact.html">Contact</a></li>
				</ul>
			</div>
		</div>
		<!-- /.container -->
	</nav>

	<div class="content">
		<div id="map"></div>
        <div class="legende">
            <div id="scene-id">Scene ID: </div>
            <div id="scene-date">Date: </div>
            <div id="scene-cloud">Cloud: </div>
            </div>
	</div>

   <!-- Modal -->
    <div  id="modalShare" class="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="sharezone">
            <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle"></i></button>
            <a id="twitter" class="sharebutt" href="" title="Share on Twitter" target="_blank">
                <i class="fa fa-twitter"></i>
            </a>
            <a id="linkedin" class="sharebutt" href="" title="Share on LinkedIn" target="_blank">
                <i class="fa fa-linkedin"></i>
            </a>
            <a id="facebook" class="sharebutt" href="" title="Share on Facebook" target="_blank">
                <i class="fa fa-facebook"></i>
            </a>
        </div>
    </div>
    <!-- /.modal -->

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog"
        aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                </div>
                <div class="modal-body" style="text-align:center">

                    <img id="landsat-thumb-modal" src="" class="img-thumb-modal">

	                <div class="row-fluid">
                        <a id="jpg_button" class="btn btn-small btn-success tip_button" href=""
                            target="_blank">Download Jpeg</a>

                        <a id="bund_button" class="btn btn-small btn-success tip_button" href=""
                            target="_blank">Download Bundle</a>
	                </div>

                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->

    <!-- jQuery -->
    <script src="/js/jquery.js"></script>
    <script src="/js/jquery.easing.min.js"></script>
    <script src="/js/moment.min.js"></script>

    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/spin.min.js"></script>

    <script src="/js/leaflet.js"></script>
    <script src="/js/leaflet.spin.js"></script>
    <script src="/js/L.ImageTransform.js"></script>
    <script src="/js/easy-button.js"></script>

    <script src="/js/turf.min.js" charset="utf-8"></script>

    <script>

		function getUrlVars() {
		    "use strict";
		    var vars = {},
		        parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
		            vars[key] = value;
		        });
		    return vars;
		}

        function getDataAndUpdate(sceneID) {

		    var api_url = "https://api.remotepixel.ca/landsat?search=",
            	adress = api_url + sceneID;

            map.spin(true);

			scope = {results:[]};
        	$.getJSON(adress, function(data) {
        		var total = data.info.results.total;
				if (total < 2000){
				    for (var i=0; i < data.results.length; i++){
                        var scene = {};
                        scene.sceneStartTime = moment(data.results[i].sceneStartTime, ["YYYY-MM-DD HH:mm:ss.S", "YYYY:DDD:HH:mm:ss"]).toDate();
                        scene.sceneStopTime = moment(data.results[i].sceneStopTime, ["YYYY-MM-DD HH:mm:ss.S", "YYYY:DDD:HH:mm:ss"]).toDate();
                        scene.lat = data.results[i].sceneCenterLatitude;
                        scene.lon = data.results[i].sceneCenterLongitude;
                        scene.acquisitionDate = data.results[i].acquisitionDate;
                        scene.browseAvailable = data.results[i].browseAvailable;
                        scene.browseURL = data.results[i].browseURL;
                        scene.ThumbURL = (scene.browseURL).replace('browse', "browse/thumbnails");
                        scene.cloudCover = data.results[i].cloudCover;
                        scene.cloudCoverFull = data.results[i].cloudCoverFull;
                        scene.dayOrNight = data.results[i].dayOrNight;
                        scene.path = data.results[i].path;
                        scene.row = data.results[i].row;
                        scene.sceneID = data.results[i].sceneID;
                        scene.sensor = data.results[i].sensor;
                        scene.sunAzimuth = data.results[i].sunAzimuth;
                        scene.sunElevation = data.results[i].sunElevation;
                        scene.lowerLeftCornerLatitude = data.results[i].lowerLeftCornerLatitude;
                        scene.lowerLeftCornerLongitude = data.results[i].lowerLeftCornerLongitude;
                        scene.lowerRightCornerLatitude = data.results[i].lowerRightCornerLatitude;
                        scene.lowerRightCornerLongitude = data.results[i].lowerRightCornerLongitude;
                        scene.upperLeftCornerLatitude = data.results[i].upperLeftCornerLatitude;
                        scene.upperLeftCornerLongitude = data.results[i].upperLeftCornerLongitude;
                        scene.upperRightCornerLatitude = data.results[i].upperRightCornerLatitude;
                        scene.upperRightCornerLongitude = data.results[i].upperRightCornerLongitude;
                        scene.className = scene.sceneID + '-' + scene.row + '-' + scene.path;
                        scene.downloadURL = 'https://storage.googleapis.com/earthengine-public/landsat/L8/' + zeroPad(data.results[i].path,3) + '/' + zeroPad(data.results[i].row,3) + '/' + data.results[i].sceneID + '.tar.bz';
                        scene.gApiURL = 'https://www.googleapis.com/storage/v1/b/earthengine-public/o/landsat%2FL8%2F' + zeroPad(data.results[i].path,3) + '%2F' + zeroPad(data.results[i].row,3) + '%2F' + data.results[i].sceneID + '.tar.bz';

                        var diff_L = Math.abs(scene.lowerLeftCornerLongitude - scene.lowerRightCornerLongitude);
                        var diff_U = Math.abs(scene.upperLeftCornerLongitude - scene.upperRightCornerLongitude);
                        if ((diff_L > 180) || (diff_U > 180)){
                        	if (scene.lowerLeftCornerLongitude < 0) scene.lowerLeftCornerLongitude += 360;
                            if (scene.upperLeftCornerLongitude < 0) scene.upperLeftCornerLongitude += 360;
                            if (scene.lowerRightCornerLongitude < 0) scene.lowerRightCornerLongitude += 360;
                            if (scene.upperRightCornerLongitude < 0) scene.upperRightCornerLongitude += 360;
                        };

                        scope.results.push(scene);

				    };
				};

				var scene = scope.results[0],
            		polygon = turf.polygon([[
            	                             [scene.upperLeftCornerLongitude, scene.upperLeftCornerLatitude],
            	                             [scene.upperRightCornerLongitude, scene.upperRightCornerLatitude],
            	                             [scene.lowerRightCornerLongitude, scene.lowerRightCornerLatitude],
            	                             [scene.lowerLeftCornerLongitude, scene.lowerLeftCornerLatitude],
            	                             [scene.upperLeftCornerLongitude, scene.upperLeftCornerLatitude]
										 ]]),

            		bbox = turf.extent(polygon),
	            	anchors = [
                               [bbox[3], bbox[0]],
                               [bbox[3], bbox[2]],
                               [bbox[1], bbox[2]],
                               [bbox[1], bbox[0]]
                	],
                	clipCoords = [
                                  [scene.upperLeftCornerLatitude, scene.upperLeftCornerLongitude],
                                  [scene.upperRightCornerLatitude, scene.upperRightCornerLongitude],
                                  [scene.lowerRightCornerLatitude, scene.lowerRightCornerLongitude],
                                  [scene.lowerLeftCornerLatitude, scene.lowerLeftCornerLongitude],
                                  [scene.upperLeftCornerLatitude, scene.upperLeftCornerLongitude]
                	],
                	options = {
                        attribution: "&copy Landsat imagery courtesy of NASA and USGS",
                        id: scene.sceneID,
                        info: {sceneID: scene.sceneID, date: scene.date, cloud: scene.cloud, url: scene.browseURL, dwUrl: scene.downloadURL, gApiUrl: scene.gApiURL, row: scene.row, path: scene.path},
                        clip: clipCoords
                	},
	                imOverlay = new L.ImageTransform(scene.browseURL, anchors, options); //https://github.com/ScanEx/Leaflet.imageTransform

    			imOverlayGr.clearLayers();
    		    imOverlayGr.addLayer(imOverlay);
                map.fitBounds(imOverlay._bounds);

                controlLayer.addOverlay(imOverlayGr, scene.sceneID);
    	        $("#scene-id").text("Scene ID: " + scene.sceneID);
    	        $("#scene-date").text("Date: " + scene.acquisitionDate);
    	        $("#scene-cloud").text("Cloud: " + scene.cloudCoverFull + "%");
	            map.spin(false);
			}).fail(function() {
				map.spin(false);
  			});

        };

        //from libra code
        function zeroPad(n,c) {
            var s = String(n);
            if (s.length < c) {
                return zeroPad('0' + n,c);
            }else {
                return s;
            };
        };

        var map = L.map('map', {
            center: [0, 0],
            bounceAtZoomLimits: false,
            zoom: 2,
			zoomControl: false,
            minZoom: 1,
            maxZoom: 10
        });

        var osm_url = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
        	attribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        	OpenStreetMap = L.tileLayer(osm_url, {id: 'MapID', attribution: attribution}).addTo(map),

			mapLink ='<a href="https://www.esri.com/">Esri</a>',
        	wholink = 'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
        	esriWorld = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            	attribution: '&copy; '+mapLink+', '+wholink,
            	maxZoom: 18
			});

		var baseMaps = {
		    "OpenStreetMap": OpenStreetMap,
            "ESRI-Satellite" : esriWorld,
		};

        L.control.zoom({position:'topright'}).addTo(map);

        var controlLayer = L.control.layers(baseMaps, '', {position:'bottomright'}).addTo(map);
        	imOverlayGr = new L.layerGroup().addTo(map),

        L.easyButton('fa-download',
        	function (){
	    	    if (! imOverlayGr.getLayers().length == 0){
	        		var lyr = imOverlayGr.getLayers()[0];

	            	$('#landsat-thumb-modal').attr('src', lyr.options.info.url);
	            	$('#jpg_button').attr('href', lyr.options.info.url);
	                $('#bund_button').attr('href', lyr.options.info.dwUrl);

	                if (UrlExists(lyr.options.info.gApiURL)){
	                	$('#bund_button').addClass('disabled')
	                }else{
	                	$('#bund_button').removeClass('disabled')
	                }

	            	$('#myModalLabel').text(lyr.options.info.sceneID + "  (" + zeroPad(lyr.options.info.path,3) + "|" + zeroPad(lyr.options.info.row,3) + ")");
	            	$('#myModal').modal()
	            };
            },
            'Download');

        L.easyButton('fa-share',
                function (){

        			if (imOverlayGr.getLayers().length != 0){
    		            $("#twitter").attr('href',
    		            		'https://twitter.com/share?url=' + window.location.href +
                				'&via=RemotePixel' +
                				'&hashtags=Landsat' +
                				'&related=NASA_Landsat' +
                				'&text=Check out this beautiful Landsat 8 image');

    		            $("#linkedin").attr('href',
    		            		'https://www.linkedin.com/shareArticle?mini=true&url=' + window.location.href+
    		            		'&title=Check out this beautiful Landsat 8 image' +
    		            		'&source=https://remotepixel.ca');

    		            $("#facebook").attr('href',
    		            		'https://www.facebook.com/sharer/sharer.php?u=' + window.location.href);

    	            }else{
                        $("#twitter").attr('href','https://twitter.com/share?text=A day by day visualisation of Landsat 8 images&url=https://remotepixel.ca/projects/adayoflandsat8.html&via=RemotePixel&hashtags=Landsat&related=NASA_Landsat');
    		            $("#linkedin").attr('href','https://www.linkedin.com/shareArticle?mini=true&url=https://remotepixel.ca/projects/adayoflandsat8.html&title=A day by day visualisation of Landsat 8 images&source=https://remotepixel.ca');
    		            $("#facebook").attr('href','https://www.facebook.com/sharer/sharer.php?u=https://remotepixel.ca/projects/adayoflandsat8.html');
                    }

            	    $('#modalShare').modal();
                },
                'Share it');

        map.fitWorld();

		$( document ).ready(function() {
			var keys = getUrlVars();
		    if (keys.hasOwnProperty('sceneid')) {
		        getDataAndUpdate(keys.sceneid);
		    }

		});
    </script>
</body>
</html>
