<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="A day by day visualisation of Landsat 8 images">
	<meta name="author" content="Vincent Sarago">
    <meta name="twitter:title" content="A day Landsat 8" />
    <meta name="twitter:site" content="@RemotePixel" />
    <meta name="twitter:description" content="A day by day visualisation of Landsat 8 images" />

	<title>Remote Pixel | A Day of Landsat 8</title>

    <!-- leaflet CSS -->
    <link href="/css/leaflet.css" rel="stylesheet">

	<!-- Bootstrap Core CSS -->
	<link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/bootstrap-datepicker3.css" rel="stylesheet">

	<!-- Custom CSS -->
	<link href="/css/rpix_general.css" rel="stylesheet">
    <link href="/css/rpix_adayoflandsat.css" rel="stylesheet">

	<!-- Custom Fonts -->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
	        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	    <![endif]-->

	<script>
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	  ga('create', 'UA-60678866-1', 'auto');
	  ga('send', 'pageview');
	</script>
</head>

<body data-target=".navbar-fixed-top">
    <!-- Navigation -->
	<nav class="navbar navbar-custom navbar-fixed-top top-nav-collapse" role="navigation">
		<div class="container">
			<div class="navbar-header">
			    <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target=".navbar-main-collapse">
                    <i class="fa fa-bars" style="color: #fff"></i></button>

				<a class="navbar-brand page-scroll" href="/projects/index.html#adayofL8">
				    <i class="fa fa-play-circle"></i>
				    <span class="light">back to Projects</span>
			    </a>
			</div>
			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse navbar-right navbar-main-collapse">
				<ul class="nav navbar-nav">
					<!-- Hidden li included to remove active class from about link when scrolled up past about section -->
                    <li class="hidden"><a href="#page-top"></a></li>
                    <li><a class="glyphicon glyphicon-home" href="/"></a></li>
                    <li><a href="/projects/index.html">projects</a></li>
                    <li><a href="/blog/index.html">Blog</a></li>
                    <li><a href="/contact.html">Contact</a></li>
				</ul>
			</div>
		</div>
		<!-- /.container -->
	</nav>

	<div class="content">
	    <div class="row main-container">

	        <div id="left-wall" class="col-md-4 col-xs-4 col-lg-4 left-wall on">
                <div id="h4noim">
                    <h4>No Landsat 8 Image Available</h4>
                </div>

                <div class="row sort">
                    <div id="button-sort-date" onclick="sortDate()">
				        <a class="btn btn-default">
	                        <i class="fa fa-calendar-o"></i>
	                        <i id="sort_date_arrow" class="fa"></i>
				        </a>
				    </div>

                    <div id="button-sort-cloud" onclick="sortCloud()">
                        <a class="btn btn-default">
                            <i class="fa fa-cloud"></i>
                            <i id="sort_cloud_arrow" class="fa"></i>
                        </a>
                    </div>
                </div>

	            <div id="landsat-wall"></div>
	        </div>

   	        <div id="map">
                <h4 id="date-butt"></h4>
   	        </div>

	    </div>
	</div>

   <!-- Modal -->
    <div  id="modalShare" class="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="sharezone">
            <button type="button" class="close" data-dismiss="modal"><i class="fa fa-times-circle"></i></button>
            <a id="twitter" class="sharebutt" href="" title="Share on Twitter" target="_blank">
                <i class="fa fa-twitter"></i>
            </a>
            <a id="linkedin" class="sharebutt" href="" title="Share on LinkedIn" target="_blank">
                <i class="fa fa-linkedin"></i>
            </a>
            <a id="facebook" class="sharebutt" href="" title="Share on Facebook" target="_blank">
                <i class="fa fa-facebook"></i>
            </a>
        </div>
    </div>
    <!-- /.modal -->

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog"
        aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                </div>
                <div class="modal-body" style="text-align:center">

                    <img id="landsat-thumb-modal" src="" class="img-thumb-modal">

	                <div class="row-fluid">
                        <a id="jpg_button" class="btn btn-small btn-success tip_button" href=""
                            target="_blank">Download Jpeg</a>

                        <a id="bund_button" class="btn btn-small btn-success tip_button" href=""
                            target="_blank">Download Bundle</a>
	                </div>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->

    <!-- Modal -->
    <div class="modal fade" id="modalAbout" tabindex="-1" role="dialog"
        aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                    <h4 class="modal-title" style="text-align:center;">A day Landsat 8</h4>
                </div>
                   <div class="modal-body">
                        <div class="hmodal-info">
                            <p>A day of Landsat 8 is a tool to visualize all Landsat 8 satellite imagery on a particular date.</p>

                            <ol class="deci">
                                <li>Select a day in the date picker at the top left</li>
                                <li>Scroll the image wall</li>
                                <li>Click on a image to see it on the map</li>
                                <li>Share it on twitter, linkedin or facebook <i class="fa fa-share"></i> </li>
                                <li>Download <i class="fa fa-download"></i> the image jpeg or the bundle</li>
                            </ol>

                            <p>Search results are powered by <a href="http://api.remotepixel.ca/landsat" target="_blank">RemotePixel Landsat API</a>
                                and images from <a href="http://earthexplorer.usgs.gov" target="_blank">USGS Earth Explorer</a>.</p>

                            <p>Questions or comments to <a href="mailto:vincent.sarago@gmail.com">vincent.sarago@gmail.com</a></p>

                        </div>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->


    <!-- jQuery -->
    <script src="/js/jquery.js"></script>
    <script src="/js/jquery.easing.min.js"></script>

    <script src="/js/moment.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/bootstrap-datepicker.js"></script>
    <script src="/js/spin.min.js"></script>
    <script src="/js/leaflet.js"></script>
    <script src="/js/leaflet.spin.js"></script>
    <script src="/js/L.ImageTransform.js"></script>
    <script src="/js/easy-button.js"></script>
    <script src="/js/turf.min.js" charset="utf-8"></script>

    <script>
        window.lazySizesConfig = window.lazySizesConfig || {};
        window.lazySizesConfig.lazyClass = 'img-thumb';
        window.lazySizesConfig.expand = 500;
        window.lazySizesConfig.loadMode = 3;
    </script>
    <script src="/js/lazysizes.min.js"></script>

    <script>

        /**
        * Makes a Google Storage JSON API request to get the download file size.
        */
        function UrlExists(requestURL) {
            $.ajaxSetup({async: false});
            var noData = true;
            $.ajax({
            	type: 'HEAD',
            	url: requestURL,
	            success: function(data){
	                noData = false;
	            },
	            error: function(){
		            // google doesn't have the scene yet
		            noData = true;
	            }
            });
            $.ajaxSetup({async: true});
            return noData
        };

		function reset(){
            var locDate = new Date(),
                utcDate = new Date(locDate.getTime() + (locDate.getTimezoneOffset() * 60000));

            scope.current_date = moment().utc().format('YYYY-MM-DD');

            $('#date-butt').datepicker('update', scope.current_date);
	        $('#date-butt').html(scope.current_date);

	        var query = scope.api_url + "acquisitionDate:" + scope.current_date + "&limit=1000";
            getDataAndUpdate(query);
		};

        function sortScenesDateUP(a, b){
            return Date.parse(a.sceneStartTime) - Date.parse(b.sceneStartTime);
        };

        function sortScenesDateDOWN(a, b){
            return Date.parse(b.sceneStartTime)-Date.parse(a.sceneStartTime);
        };

        function sortScenesCloudUP(a, b){
            return a.cloudCoverFull - b.cloudCoverFull;
        };

        function sortScenesCloudDOWN(a, b){
            return b.cloudCoverFull - a.cloudCoverFull;
        };

        function sortDate(){
            $('#landsat-wall').empty();
            $('#landsat-wall').scrollTop(0);

            imOverlayGr.clearLayers()
            footprintGr.clearLayers()

            $("#sort_cloud_arrow").removeClass('fa-long-arrow-down');
            $("#sort_cloud_arrow").removeClass('fa-long-arrow-up');

        	if ($("#sort_date_arrow").hasClass('fa-long-arrow-up')){
        		$("#sort_date_arrow").removeClass('fa-long-arrow-up');
                $("#sort_date_arrow").addClass('fa-long-arrow-down');
                (scope.results).sort(sortScenesDateDOWN);
        	}else{
        		$("#sort_date_arrow").removeClass('fa-long-arrow-down');
        		$("#sort_date_arrow").addClass('fa-long-arrow-up');
                (scope.results).sort(sortScenesDateUP);
        	};
            populate_ImgPol();
        }

        function sortCloud(){
            $('#landsat-wall').empty();
            $('#landsat-wall').scrollTop(0);

            imOverlayGr.clearLayers()
            footprintGr.clearLayers()

            $("#sort_date_arrow").removeClass('fa-long-arrow-down');
            $("#sort_date_arrow").removeClass('fa-long-arrow-up');

            if ($("#sort_cloud_arrow").hasClass('fa-long-arrow-up')){
                (scope.results).sort(sortScenesCloudDOWN);
                $("#sort_cloud_arrow").removeClass('fa-long-arrow-up');
                $("#sort_cloud_arrow").addClass('fa-long-arrow-down');
            }else{
                (scope.results).sort(sortScenesCloudUP);
                $("#sort_cloud_arrow").removeClass('fa-long-arrow-down');
                $("#sort_cloud_arrow").addClass('fa-long-arrow-up');
            };
            populate_ImgPol();
        }

        function cleanApp(){
            $('#landsat-wall').empty();
            $('#landsat-wall').scrollTop(0);

            $("#sort_date_arrow").removeClass('fa-long-arrow-down');
            $("#sort_date_arrow").addClass('fa-long-arrow-up');
            $("#sort_cloud_arrow").removeClass('fa-long-arrow-down');
            $("#sort_cloud_arrow").removeClass('fa-long-arrow-up');

            imOverlayGr.clearLayers();
            footprintGr.clearLayers();

            scope.results = [];

            if (typeof(scope.l8point) != 'undefined'){
                map.removeLayer(scope.l8point);
                scope.l8point = undefined;
            };

            map.fitWorld()
        };

        function getDataAndUpdate(adress) {

        	$("#h4noim").addClass("display-none");

        	map.spin(true);

			cleanApp();

        	$.getJSON(adress, function(data) {
        		var total = data.info.results.total;
				if (total < 2000){
				    for (var i=0; i < data.results.length; i++){
                        var scene = {};
                        scene.sceneStartTime = moment(data.results[i].sceneStartTime, ["YYYY-MM-DD HH:mm:ss.S", "YYYY:DDD:HH:mm:ss"]).toDate();
                        scene.sceneStopTime = moment(data.results[i].sceneStopTime, ["YYYY-MM-DD HH:mm:ss.S", "YYYY:DDD:HH:mm:ss"]).toDate();
                        scene.lat = data.results[i].sceneCenterLatitude;
                        scene.lon = data.results[i].sceneCenterLongitude;
                        scene.acquisitionDate = data.results[i].acquisitionDate;
                        scene.browseAvailable = data.results[i].browseAvailable;
                        scene.browseURL = data.results[i].browseURL.replace('http://', "https://");
                        scene.ThumbURL = (scene.browseURL).replace('browse', "browse/thumbnails");
                        scene.cloudCover = data.results[i].cloudCover;
                        scene.cloudCoverFull = data.results[i].cloudCoverFull;
                        scene.dayOrNight = data.results[i].dayOrNight;
                        scene.path = data.results[i].path;
                        scene.row = data.results[i].row;
                        scene.sceneID = data.results[i].sceneID;
                        scene.sensor = data.results[i].sensor;
                        scene.sunAzimuth = data.results[i].sunAzimuth;
                        scene.sunElevation = data.results[i].sunElevation;
                        scene.lowerLeftCornerLatitude = data.results[i].lowerLeftCornerLatitude;
                        scene.lowerLeftCornerLongitude = data.results[i].lowerLeftCornerLongitude;
                        scene.lowerRightCornerLatitude = data.results[i].lowerRightCornerLatitude;
                        scene.lowerRightCornerLongitude = data.results[i].lowerRightCornerLongitude;
                        scene.upperLeftCornerLatitude = data.results[i].upperLeftCornerLatitude;
                        scene.upperLeftCornerLongitude = data.results[i].upperLeftCornerLongitude;
                        scene.upperRightCornerLatitude = data.results[i].upperRightCornerLatitude;
                        scene.upperRightCornerLongitude = data.results[i].upperRightCornerLongitude;
                        scene.className = scene.sceneID + '-' + scene.row + '-' + scene.path;
                        scene.downloadURL = 'https://storage.googleapis.com/earthengine-public/landsat/L8/' + zeroPad(data.results[i].path,3) + '/' + zeroPad(data.results[i].row,3) + '/' + data.results[i].sceneID + '.tar.bz';
                        scene.gApiURL = 'https://www.googleapis.com/storage/v1/b/earthengine-public/o/landsat%2FL8%2F' + zeroPad(data.results[i].path,3) + '%2F' + zeroPad(data.results[i].row,3) + '%2F' + data.results[i].sceneID + '.tar.bz';

                        var diff_L = Math.abs(scene.lowerLeftCornerLongitude - scene.lowerRightCornerLongitude);
                        var diff_U = Math.abs(scene.upperLeftCornerLongitude - scene.upperRightCornerLongitude);
                        if ((diff_L > 180) || (diff_U > 180)){
                        	if (scene.lowerLeftCornerLongitude < 0) scene.lowerLeftCornerLongitude += 360;
                            if (scene.upperLeftCornerLongitude < 0) scene.upperLeftCornerLongitude += 360;
                            if (scene.lowerRightCornerLongitude < 0) scene.lowerRightCornerLongitude += 360;
                            if (scene.upperRightCornerLongitude < 0) scene.upperRightCornerLongitude += 360;
                        }

                        if ((scene.browseAvailable == "Y") && (scene.dayOrNight == "DAY")){
							scope.results.push(scene);
					    };
				    };
				};

				(scope.results).sort(sortScenesDateUP);
				populate_ImgPol();
				map.fitBounds(footprintGr.getBounds());
	            map.spin(false);
	            map.invalidateSize();

        	}).fail(function() {
        		map.spin(false);
				$("#h4noim").removeClass("display-none");
				map.invalidateSize();
			});
        };

        function populate_ImgPol(){

            var defaultStyle = {
                    color: "#000",
                    weight: 0.3,
                    fill: true,
                    fillOpacity: 0,
                    opacity: 1
            };

            var highlightStyle = {
                    color: '#2262CC',
                    weight: 3,
                    opacity: 0.6,
                    fill: true,
                    fillOpacity: 0.65,
                    fillColor: '#2262CC'
            };

            var browse = [];
            for (var i=0, iLen = scope.results.length; i<iLen; i++) {

                var LL = L.latLng(scope.results[i].lowerLeftCornerLatitude, scope.results[i].lowerLeftCornerLongitude),
                    LR = L.latLng(scope.results[i].lowerRightCornerLatitude, scope.results[i].lowerRightCornerLongitude),
                    UL = L.latLng(scope.results[i].upperLeftCornerLatitude, scope.results[i].upperLeftCornerLongitude),
                    UR = L.latLng(scope.results[i].upperRightCornerLatitude, scope.results[i].upperRightCornerLongitude);

                var poly = L.polygon([LL, LR, UR, UL], defaultStyle)
                    .on('mouseover', function () {this.setStyle(highlightStyle);})
                    .on('mouseout', function () {this.setStyle(defaultStyle);})
                    .on('click', onClickScene);

                poly.scene = {};
                poly.scene.num = i;
                poly.scene.url = scope.results[i].browseURL;
                poly.scene.sceneID = scope.results[i].sceneID;

                footprintGr.addLayer(poly);

                var timeUTC = moment(scope.results[i].sceneStartTime).format('HH:mm:ss')
                browse.push(
                    '<div class="result-content">' +
                        '<img id="' + scope.results[i].sceneID +  '" ' +
                        'class="no-src img-thumb"' +
                        'data-sizes="auto" data-src="' + scope.results[i].browseURL + '" ' +
                        'onmouseover="imgover('+i+')"'+
                        'onclick="imgclick('+i+')" >' +

                        '<div class="result-overlay">' +
                            '<div>' +
                                '<i class="fa fa-calendar-o"></i>' +
                                '<span>  ' + timeUTC + '(UTC)</span>' +
                            '</div>' +
                            '<div>' +
                                '<i class="fa fa-cloud"></i>' +
                                '<span>  ' + scope.results[i].cloudCoverFull + ' %</span>' +
                            '</div>' +
                        '</div>' +
                    '</div>');
            };

            $('#landsat-wall').append(browse);

        };

        //from libra code
        function zeroPad(n,c) {
            var s = String(n);
            if (s.length < c) {
                return zeroPad('0' + n,c);
            }else {
                return s;
            };
        };

		function imgover(num) {
			if(typeof(scope.l8point)==='undefined'){

				scope.l8point = new L.marker( [scope.results[num].lat, scope.results[num].lon])
					.addTo(map)
					.on('click', onClickMarker);
		 	}else{
		 		scope.l8point.setLatLng([scope.results[num].lat, scope.results[num].lon]);
		 	};
		};

		function imgclick(num) {
            var scene = scope.results[num];

            var polygon = turf.polygon([[
                                         [scene.upperLeftCornerLongitude, scene.upperLeftCornerLatitude],
                                         [scene.upperRightCornerLongitude, scene.upperRightCornerLatitude],
                                         [scene.lowerRightCornerLongitude, scene.lowerRightCornerLatitude],
                                         [scene.lowerLeftCornerLongitude, scene.lowerLeftCornerLatitude],
                                         [scene.upperLeftCornerLongitude, scene.upperLeftCornerLatitude]
                                        ]]);

            var bbox = turf.extent(polygon);

            var anchors = [
                           [bbox[3], bbox[0]],
                           [bbox[3], bbox[2]],
                           [bbox[1], bbox[2]],
                           [bbox[1], bbox[0]]
            ];

            var clipCoords = [
                              [scene.upperLeftCornerLatitude, scene.upperLeftCornerLongitude],
                              [scene.upperRightCornerLatitude, scene.upperRightCornerLongitude],
                              [scene.lowerRightCornerLatitude, scene.lowerRightCornerLongitude],
                              [scene.lowerLeftCornerLatitude, scene.lowerLeftCornerLongitude],
                              [scene.upperLeftCornerLatitude, scene.upperLeftCornerLongitude]
            ];

            var options = {
                    attribution: "&copy Landsat imagery courtesy of NASA and USGS",
                    id: scene.sceneID,
                    info: {sceneID: scene.sceneID, date: scene.date, cloud: scene.cloud, url: scene.browseURL, dwUrl: scene.downloadURL, gApiUrl: scene.gApiURL, row: scene.row, path: scene.path},
                    clip: clipCoords
            };

            var imOverlay = new L.ImageTransform(scene.browseURL, anchors, options); //https://github.com/ScanEx/Leaflet.imageTransform

            if (imOverlayGr.getLayers().length != 0){
				if (imOverlayGr.getLayers()[0].options.id == scene.sceneID){
					imOverlayGr.clearLayers();
					return
				};
			};

			imOverlayGr.clearLayers();
		    imOverlayGr.addLayer(imOverlay);
            map.fitBounds(imOverlay._bounds);
		};

		function onClickMarker(){
			zoom = (map._zoom + 1);
			map.setView(this.getLatLng(), zoom);
		};

        function onClickScene(){

            if (imOverlayGr.getLayers().length != 0){
            	imOverlayGr.clearLayers()
            };

            var scene = scope.results[this.scene.num];

            var polygon = turf.polygon([[
                                         [scene.upperLeftCornerLongitude, scene.upperLeftCornerLatitude],
                                         [scene.upperRightCornerLongitude, scene.upperRightCornerLatitude],
                                         [scene.lowerRightCornerLongitude, scene.lowerRightCornerLatitude],
                                         [scene.lowerLeftCornerLongitude, scene.lowerLeftCornerLatitude],
                                         [scene.upperLeftCornerLongitude, scene.upperLeftCornerLatitude]
                                        ]]);

            var bbox = turf.extent(polygon);

            var anchors = [
                           [bbox[3], bbox[0]],
                           [bbox[3], bbox[2]],
                           [bbox[1], bbox[2]],
                           [bbox[1], bbox[0]]
            ];

	        var clipCoords = [
	                          [scene.upperLeftCornerLatitude, scene.upperLeftCornerLongitude],
	                          [scene.upperRightCornerLatitude, scene.upperRightCornerLongitude],
	                          [scene.lowerRightCornerLatitude, scene.lowerRightCornerLongitude],
	                          [scene.lowerLeftCornerLatitude, scene.lowerLeftCornerLongitude],
	                          [scene.upperLeftCornerLatitude, scene.upperLeftCornerLongitude]
	        ];

	        var options = {
	                attribution: "&copy Landsat imagery courtesy of NASA and USGS",
	                id: scene.sceneID,
	                info: {sceneID: scene.sceneID, date: scene.date, cloud: scene.cloud, url: scene.browseURL, dwUrl: scene.downloadURL, gApiUrl: scene.gApiURL, row: scene.row, path: scene.path},
	                clip: clipCoords
	        };

	        var imOverlay = new L.ImageTransform(scene.browseURL, anchors, options); //https://github.com/ScanEx/Leaflet.imageTransform
	        imOverlayGr.addLayer(imOverlay);
        };

        var scope = {
        	api_url: "https://api.remotepixel.ca/landsat?search=",
        	current_date: moment().format('YYYY-MM-DD'),
        	l8point: undefined,
        	results: []
        };

        $('#date-butt').html(scope.current_date);

        var map = L.map('map', {
            center: [0, 0],
            bounceAtZoomLimits: false,
            worldCopyJump: false,
			zoomControl: false,
            minZoom: 1,
            maxZoom: 10
        });

        var osm_url = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
        var attribution = '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';
        var OpenStreetMap = L.tileLayer(osm_url, {id: 'MapID', attribution: attribution})
                .addTo(map);

		var mapLink ='<a href="http://www.esri.com/">Esri</a>';
        var wholink = 'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community';
        var esriWorld = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: '&copy; '+mapLink+', '+wholink,
            maxZoom: 18});

		var baseMaps = {
		    "OpenStreetMap": OpenStreetMap,
            "ESRI-Satellite" : esriWorld,
		};

        L.control.zoom({position:'topright'}).addTo(map);
        L.control.layers(baseMaps, '', {position:'bottomright'}).addTo(map);

        var imOverlayGr = new L.layerGroup().addTo(map);
        var footprintGr = new L.featureGroup().addTo(map);

        map.fitWorld();

        L.easyButton('fa-home',
                function (){
                    reset()
                },
                'Reset');

        L.easyButton('fa-download',
        	function (){

        	    if (imOverlayGr.getLayers().length == 0){
	        		//alert('No Landsat 8 scene selected!');
	            }else{
	            	var lyr = imOverlayGr.getLayers()[0];

	            	$('#landsat-thumb-modal').attr('src', lyr.options.info.url);
	            	$('#jpg_button').attr('href', lyr.options.info.url);
	                $('#bund_button').attr('href', lyr.options.info.dwUrl);

	                if (UrlExists(lyr.options.info.gApiURL)){
	                	$('#bund_button').addClass('disabled')
	                }else{
	                	$('#bund_button').removeClass('disabled')
	                }

	            	$('#myModalLabel').text(lyr.options.info.sceneID + "  (" + zeroPad(lyr.options.info.path,3) + "|" + zeroPad(lyr.options.info.row,3) + ")");
	            	$('#myModal').modal()
	            };
            },
            'Download');

            L.easyButton('fa-share',
                    function (){

                        if (imOverlayGr.getLayers().length != 0){
                        	var lyr = imOverlayGr.getLayers()[0];
                        	var share_url = "https://remotepixel.ca/projects/landsat.html?sceneid=" + lyr.options.info.sceneID;

                            $("#twitter").attr('href',
                                    'https://twitter.com/share?url=' + encodeURIComponent(share_url) +
                                    '&via=RemotePixel' +
                                    '&hashtags=Landsat' +
                                    '&related=NASA_Landsat' +
                                    '&text=Check out this beautiful Landsat image');

                            $("#linkedin").attr('href',
                                    'https://www.linkedin.com/shareArticle?mini=true&url=' + encodeURIComponent(share_url) +
                                    '&title=Check out this beautiful Landsat image' +
                                    '&source=https://remotepixel.ca');

                            $("#facebook").attr('href',
                                    'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(share_url));

                        }else{
                            $("#twitter").attr('href','https://twitter.com/share?text=A day by day visualisation of Landsat 8 images&url=' + window.location.href + '&via=RemotePixel&hashtags=Landsat&related=NASA_Landsat');
                            $("#linkedin").attr('href','https://www.linkedin.com/shareArticle?mini=true&url=' + window.location.href + '&title='+ document.title + '&source=https://remotepixel.ca');
                            $("#facebook").attr('href','https://www.facebook.com/sharer/sharer.php?u=' + window.location.href);
                        }

                        $('#modalShare').modal();
                    },
                    'Share it');


        L.easyButton('fa-info',
            function (){
               $('#modalAbout').modal()
            },
            'About')

        $( document ).ready(function() {

            var locDate = new Date(),
                utcDate = new Date(locDate.getTime() + (locDate.getTimezoneOffset() * 60000));

            $('#date-butt').datepicker({
                format: 'mm/dd/yyyy',
                autoclose: true,
                todayHighlight: true,
                startDate: new Date('2013-04-01'),
                endDate: utcDate
            }).on('changeDate', function(e){
                scope.current_date = moment(e.date).format('YYYY-MM-DD');
                $('#date-butt').html(scope.current_date);
                var query = scope.api_url + "acquisitionDate:" + scope.current_date + "&limit=1000";
                getDataAndUpdate(query);
            });

            var query = scope.api_url + "acquisitionDate:" + scope.current_date + "&limit=1000";
            getDataAndUpdate(query);
        });
    </script>

</body>
</html>
